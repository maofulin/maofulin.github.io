<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>一起来学SpringColud（一）初始微服务 | FuLinLin</title><meta name="description" content="一起来学SpringColud（一）初始微服务"><meta name="keywords" content="SpringCloud"><meta name="author" content="Fulin"><meta name="copyright" content="Fulin"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="一起来学SpringColud（一）初始微服务"><meta name="twitter:description" content="一起来学SpringColud（一）初始微服务"><meta name="twitter:image" content="http://yoursite.com/img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="一起来学SpringColud（一）初始微服务"><meta property="og:url" content="http://yoursite.com/2019/07/25/%E4%B8%80%E8%B5%B7%E6%9D%A5%E5%AD%A6SpringColud%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%9D%E5%A7%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><meta property="og:site_name" content="FuLinLin"><meta property="og:description" content="一起来学SpringColud（一）初始微服务"><meta property="og:image" content="http://yoursite.com/img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2019/07/25/%E4%B8%80%E8%B5%B7%E6%9D%A5%E5%AD%A6SpringColud%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%9D%E5%A7%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><link rel="prev" title="SpringBoot 常用的部署方式" href="http://yoursite.com/2019/07/25/SpringBoot%20%E5%B8%B8%E7%94%A8%E7%9A%84%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F/"><link rel="next" title="Centos7 安装gitlab" href="http://yoursite.com/2019/07/25/Centos7%20%E5%AE%89%E8%A3%85gitlab/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.fulinlin.com","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">FuLinLin</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 连接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">19</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 连接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#项目的演变"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">项目的演变</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#什么是服务化？"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">什么是服务化？</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#SOA-vs-微服务"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">SOA vs 微服务</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#微服务的提出"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">微服务的提出</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#简单的微服务架构"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">简单的微服务架构</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#这么多服务，怎么找"><span class="toc_mobile_items-number">1.4.1.</span> <span class="toc_mobile_items-text">这么多服务，怎么找?</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#客户端如何访问这些服务？"><span class="toc_mobile_items-number">1.4.2.</span> <span class="toc_mobile_items-text">客户端如何访问这些服务？</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#服务之间如何通信"><span class="toc_mobile_items-number">1.4.3.</span> <span class="toc_mobile_items-text">服务之间如何通信?</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#这么多服务，服务挂了怎么办？"><span class="toc_mobile_items-number">1.4.4.</span> <span class="toc_mobile_items-text">这么多服务，服务挂了怎么办？</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#微服务架构的优点"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">微服务架构的优点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#微服务架构的缺点和挑战"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">微服务架构的缺点和挑战</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#总结"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">总结</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#项目的演变"><span class="toc-number">1.</span> <span class="toc-text">项目的演变</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是服务化？"><span class="toc-number">1.1.</span> <span class="toc-text">什么是服务化？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SOA-vs-微服务"><span class="toc-number">1.2.</span> <span class="toc-text">SOA vs 微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#微服务的提出"><span class="toc-number">1.3.</span> <span class="toc-text">微服务的提出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简单的微服务架构"><span class="toc-number">1.4.</span> <span class="toc-text">简单的微服务架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#这么多服务，怎么找"><span class="toc-number">1.4.1.</span> <span class="toc-text">这么多服务，怎么找?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#客户端如何访问这些服务？"><span class="toc-number">1.4.2.</span> <span class="toc-text">客户端如何访问这些服务？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务之间如何通信"><span class="toc-number">1.4.3.</span> <span class="toc-text">服务之间如何通信?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#这么多服务，服务挂了怎么办？"><span class="toc-number">1.4.4.</span> <span class="toc-text">这么多服务，服务挂了怎么办？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#微服务架构的优点"><span class="toc-number">1.5.</span> <span class="toc-text">微服务架构的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#微服务架构的缺点和挑战"><span class="toc-number">1.6.</span> <span class="toc-text">微服务架构的缺点和挑战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">1.7.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">一起来学SpringColud（一）初始微服务</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-07-25<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-08-19</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E4%B8%80%E8%B5%B7%E6%9D%A5%E5%AD%A6SpringCloud/">一起来学SpringCloud</a></span><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p><a name="2KtQY"></a></p>
<h2 id="项目的演变"><a href="#项目的演变" class="headerlink" title="项目的演变"></a>项目的演变</h2><p>从个大搜索指数来看，微服务的热度在进入 2017 年后突然爆发，国内各大会议和论坛的相关讨论也如雨后春笋般层出不穷，各大一线互联网公司也纷纷将这一技术引入并在实际业务中落地。</p>
<p>这里选取Dubbo官网的一副图作为分析</p>
<p><img alt data-src="https://cdn.nlark.com/yuque/0/2019/jpeg/351829/1564062903437-71cf240f-8535-493c-87e2-d2c9cbb8aa9b.jpeg#align=left&display=inline&height=210&originHeight=210&originWidth=700&size=0&status=done&width=700" class="lazyload"></p>
<p>从左到右依次为</p>
<p><strong>单一应用</strong>=》<strong>垂直应用架构</strong>=》<strong>分布式服务架构</strong>=》<strong>流动计算架构</strong>  <br><strong>单一应用架构</strong><br>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。<br><strong>垂直应用架构</strong><br>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。<br><strong>分布式服务架构</strong><br>当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的分布式服务框架(RPC)是关键。<br><strong>流动计算架构</strong><br>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的资源调度和治理中心(SOA)是关键。</p>
<p>在开聊微服务之前，我先要你和介绍下单体应用。如果你不知道单体应用的痛，那也不会深刻理解微服务的价值。</p>
<p><img alt data-src="https://cdn.nlark.com/yuque/0/2019/jpeg/351829/1564062903101-ffa95c5f-abd1-4811-81d3-2ef643ce809a.jpeg#align=left&display=inline&height=374&originHeight=374&originWidth=502&size=0&status=done&width=502" class="lazyload"></p>
<p>这里所说道的服务呢其实就是相应业务的逻辑代码，当网站流量很小时，只需一个应用，将所有功能都部署在一起，减少了部署节点和成本。这样而来呢，容易测试，容易部署，同时也会带来一些问题，开发效率低，代码维护难，如果代码出现转接，会导致后来人不知如何下手，同样呢，构建也是很头疼的一件事，小小的错误也要把所有代码重新构建一遍，稳定性和扩展性也会受到影响，可能代码中出现问题，导致整合项目崩溃，无法满足高并发下的业务需求。</p>
<p>想要解决上面这些问题，<strong>服务化</strong>的思想也就应运而生。</p>
<p><a name="17667a5f"></a></p>
<h3 id="什么是服务化？"><a href="#什么是服务化？" class="headerlink" title="什么是服务化？"></a>什么是服务化？</h3><p>这里我就不谈一些官方的、教条主义的概念了。在我看来，用通俗的话来讲，服务化就是把传统的单机应用中通过 JAR 包依赖产生的本地方法调用，改造成通过 RPC 接口产生的远程方法调用。一般在编写业务代码时，对于一些通用的业务逻辑，我会尽力把它抽象并独立成为专门的模块，因为这对于代码复用和业务理解都大有裨益。</p>
<p>在过去的项目经历里，我对此深有体会。以微博系统为例，微博既包含了内容模块，也包含了消息模块和用户模块等。其中消息模块依赖内容模块，消息模块和内容模块又都依赖用户模块。当这三个模块的代码耦合在一起，应用启动时，需要同时去加载每个模块的代码并连接对应的资源。一旦任何模块的代码出现 bug，或者依赖的资源出现问题，整个单体应用都会受到影响。</p>
<p>为此，首先可以把用户模块从单体应用中拆分出来，独立成一个服务部署，以 RPC 接口的形式对外提供服务。微博和消息模块调用用户接口，就从进程内的调用变成远程 RPC 调用。这样，用户模块就可以独立开发、测试、上线和运维，可以交由专门的团队来做，与主模块不耦合。进一步的可以再把消息模块也拆分出来作为独立的模块，交由专门的团队来开发和维护。</p>
<p>可见通过服务化，可以解决单体应用膨胀、团队开发耦合度高、协作效率低下的问题。</p>
<p><a name="f64d69fd"></a></p>
<h3 id="SOA-vs-微服务"><a href="#SOA-vs-微服务" class="headerlink" title="SOA vs 微服务"></a>SOA vs 微服务</h3><p>微服务是SOA的传承，但一个最本质的区别就在于Smart endpoints and dumb pipes，或者说是真正的分布式的、去中心化的。Smart endpoints and dumb pipes本质就是去ESB，把所有的“思考”逻辑包括路由、消息解析等放在服务内部（Smart endpoints），去掉一个大一统的ESB，服务间轻（dumb pipes）通信，是比SOA更彻底的拆分。</p>
<p><a name="dbcf47b3"></a></p>
<h3 id="微服务的提出"><a href="#微服务的提出" class="headerlink" title="微服务的提出"></a>微服务的提出</h3><p>微服务是一种架构风格，一个大型复杂软件应用由一个或多个微服务组成。系统中的各个微服务可被独立部署，各个微服务之间是松耦合的。每个微服务仅关注于完成一件任务并很好地完成该任务。在所有情况下，每个任务代表着一个小的业务能力。</p>
<p>微服务的概念源于2014年3月Martin Fowler和James Lewis所写的一篇文章“Microservices”(<a href="http://martinfowler.com/articles/microservices.html" target="_blank" rel="noopener">http://martinfowler.com/articles/microservices.html</a>)。尽管“微服务”这种架构风格没有精确的定义，但其具有一些共同的特性，如围绕业务能力组织服务、自动化部署、智能端点、对语言及数据的“去集中化”控制等等。</p>
<p>微服务架构的思考是从与整体应用对比而产生的,是一种架构风格。根据论文中的概述呢，大概有以下几点。</p>
<ul>
<li>一系列微小的服务共同组成</li>
<li>跑在自己的进程里</li>
<li>每个服务为独立的业务开发</li>
<li>独立部署</li>
<li>分布式的管理</li>
</ul>
<p>由此可见，微服务化给服务的发布和部署，以及服务的保障带来了诸多好处。</p>
<p><a name="ccfee0f1"></a></p>
<h3 id="简单的微服务架构"><a href="#简单的微服务架构" class="headerlink" title="简单的微服务架构"></a>简单的微服务架构</h3><p>微服务听上去是不错，听上去好像都不错，具体怎么落地啊？这需要回答下面几个问题：</p>
<ul>
<li>客户端如何访问这些服务？</li>
<li>服务之间如何通信？</li>
<li>这么多服务，怎么找？</li>
<li>服务挂了怎么办？</li>
</ul>
<p><a name="c42c3e32"></a></p>
<h4 id="这么多服务，怎么找"><a href="#这么多服务，怎么找" class="headerlink" title="这么多服务，怎么找?"></a>这么多服务，怎么找?</h4><p>在微服务架构中，一般每一个服务都是有多个拷贝，来做负载均衡。一个服务随时可能下线，也可能应对临时访问压力增加新的服务节点。服务之间如何相互 感知？服务如何管理？这就是服务发现的问题了。一般有两类做法，也各有优缺点。基本都是通过zookeeper等类似技术做服务注册信息的分布式管理。当 服务上线时，服务提供者将自己的服务信息注册到ZK（或类似框架），并通过心跳维持长链接，实时更新链接信息。服务调用者通过ZK寻址，根据可定制算法， 找到一个服务，还可以将服务信息缓存在本地以提高性能。当服务下线时，ZK会发通知给服务客户端。</p>
<ul>
<li>客户端做：优点是架构简单，扩展灵活，只对服务注册器依赖。缺点是客户端要维护所有调用服务的地址，有技术难度，一般大公司都有成熟的内部框架支持，比如Dubbo。</li>
<li>服务端做：优点是简单，所有服务对于前台调用方透明，一般在小公司在云服务上部署的应用采用的比较多</li>
</ul>
<p><img alt data-src="https://cdn.nlark.com/yuque/0/2019/jpeg/351829/1564062902386-0cf9bfeb-fbca-4892-9168-a9c35e1bfd69.jpeg#align=left&display=inline&height=347&originHeight=347&originWidth=836&size=0&status=done&width=836" class="lazyload"></p>
<p><a name="5aa7f524"></a></p>
<h4 id="客户端如何访问这些服务？"><a href="#客户端如何访问这些服务？" class="headerlink" title="客户端如何访问这些服务？"></a>客户端如何访问这些服务？</h4><p>通常，一个大系统里会有很多职责单一的微服务，如果门户系统或移动 APP 来调用这些微服务的 API 时，至少要做好两件事</p>
<ul>
<li>由统一的入口来调用微服务的 API</li>
<li>API 鉴权</li>
</ul>
<p>我个人认为呢，是是为前台（通常是移动应用）提供后台服务的聚合，提供一个统一的服务出口，解除他们之间的耦合，不过API Gateway也有可能成为单点故障点或者性能的瓶颈。</p>
<p><img alt data-src="https://cdn.nlark.com/yuque/0/2019/jpeg/351829/1564062902344-7241a4f2-2516-4344-8ed0-ae6ed1256f6e.jpeg#align=left&display=inline&height=466&originHeight=466&originWidth=658&size=0&status=done&width=658" class="lazyload"></p>
<p><a name="3ce14545"></a></p>
<h4 id="服务之间如何通信"><a href="#服务之间如何通信" class="headerlink" title="服务之间如何通信?"></a>服务之间如何通信?</h4><p>因为所有的微服务都是独立的Java进程跑在独立的虚拟机上，所以服务间的通行就是IPC（inter process communication），已经有很多成熟的方案。现在基本最通用的有两种方式</p>
<ul>
<li>同步调用<ul>
<li>REST（JAX-RS，Spring Boot）</li>
<li>RPC（Thrift, Dubbo）</li>
</ul>
</li>
<li>异步消息调用(Kafka, Rabbitmq)</li>
</ul>
<p>一般同步调用比较简单，一致性强，但是容易出调用问题，性能体验上也会差些，特别是调用层次多的时候。RESTful和RPC的比较也是一个很有意 思的话题。一般REST基于HTTP，更容易实现，更容易被接受，服务端实现技术也更灵活些，各个语言都能支持，同时能跨客户端，对客户端没有特殊的要 求，只要封装了HTTP的SDK就能调用，所以相对使用的广一些。RPC也有自己的优点，传输协议更高效，安全更可控，特别在一个公司内部，如果有统一个 的开发规范和统一的服务框架时，他的开发效率优势更明显些。就看各自的技术积累实际条件，自己的选择了。</p>
<p>而异步消息的方式在分布式系统中有特别广泛的应用，他既能减低调用服务之间的耦合，又能成为调用之间的缓冲，确保消息积压不会冲垮被调用方，同时能 保证调用方的服务体验，继续干自己该干的活，不至于被后台性能拖慢。不过需要付出的代价是一致性的减弱，需要接受数据最终一致性；还有就是后台服务一般要 实现幂等性，因为消息发送出于性能的考虑一般会有重复（保证消息的被收到且仅收到一次对性能是很大的考验）。最后就是必须引入一个独立的broker，如 果公司内部没有技术积累，对broker分布式管理也是一个很大的挑战。不过呢幸好我们有棒棒哒 springColud。<br><img alt data-src="https://cdn.nlark.com/yuque/0/2019/jpeg/351829/1564062902880-2fcdb951-043e-4e36-b60e-b12864c5c684.jpeg#align=left&display=inline&height=590&originHeight=590&originWidth=658&size=0&status=done&width=658" class="lazyload"></p>
<p><a name="2d696b53"></a></p>
<h4 id="这么多服务，服务挂了怎么办？"><a href="#这么多服务，服务挂了怎么办？" class="headerlink" title="这么多服务，服务挂了怎么办？"></a>这么多服务，服务挂了怎么办？</h4><p>举个例子，把所有鸡蛋放在一个篮子里，一荣俱荣，一损俱损。而分布式最大的特性就是网络是不可靠的。通过微服务拆分能降低这个风险，不过如果没有特别的保障，结局肯定是悲剧性的。我们刚遇到一个线上故障就是一个很不起眼的SQL计数功能，在访问量上升时，导致数据库load彪高，影响了所在应用的性能，从而影响所有调用这个应用服务的前台应用。所以当我们的系统是由一系列的服务调用链组成的时候，我们 必须确保任一环节出问题都不至于影响整体链路。相应的手段有很多</p>
<ul>
<li>重试机制</li>
<li>限流</li>
<li>熔断机制</li>
<li>负载均衡</li>
<li>降级（本地缓存）</li>
</ul>
<p><a name="db519b2c"></a></p>
<h3 id="微服务架构的优点"><a href="#微服务架构的优点" class="headerlink" title="微服务架构的优点"></a>微服务架构的优点</h3><p>微服务架构有很多重要的优点。首先，它解决了复杂性问题。它将单体应用分解为一组服务。虽然功能总量不变，但应用程序已被分解为可管理的模块或服务。这些服务定义了明确的RPC或消息驱动的API边界。微服务架构强化了应用模块化的水平，而这通过单体代码库很难实现。因此，微服务开发的速度要快很多，更容易理解和维护。</p>
<p>其次，这种体系结构使得每个服务都可以由专注于此服务的团队独立开发。只要符合服务API契约，开发人员可以自由选择开发技术。这就意味着开发人员可以采用新技术编写或重构服务，由于服务相对较小，所以这并不会对整体应用造成太大影响。</p>
<p>第三，微服务架构可以使每个微服务独立部署。开发人员无需协调对服务升级或更改的部署。这些更改可以在测试通过后立即部署。所以微服务架构也使得CI／CD成为可能。</p>
<p>最后，微服务架构使得每个服务都可独立扩展。我们只需定义满足服务部署要求的配置、容量、实例数量等约束条件即可。</p>
<p><a name="f9d12847"></a></p>
<h3 id="微服务架构的缺点和挑战"><a href="#微服务架构的缺点和挑战" class="headerlink" title="微服务架构的缺点和挑战"></a>微服务架构的缺点和挑战</h3><p>实际上并不存在完美的架构，微服务架构也会给我们带来新的问题和挑战。其中一个就和它的名字类似，微服务强调了服务大小，但实际上这并没有一个统一的标准。业务逻辑应该按照什么规则划分为微服务，这本身就是一个经验工程。有些开发者主张10-100行代码就应该建立一个微服务。虽然建立小型服务是微服务架构崇尚的，但要记住，微服务是达到目的的手段，而不是目标。微服务的目标是充分分解应用程序，以促进敏捷开发和持续集成部署。</p>
<p>微服务的另一个主要缺点是微服务的分布式特点带来的复杂性。开发人员需要基于RPC或者消息实现微服务之间的调用和通信，而这就使得服务之间的发现、服务调用链的跟踪和质量问题变得的相当棘手。</p>
<p>微服务的另一个挑战是分区的数据库体系和分布式事务。更新多个业务实体的业务交易相当普遍。这些类型的事务在单体应用中实现非常简单，因为单体应用往往只存在一个数据库。但在微服务架构下，不同服务可能拥有不同的数据库。CAP原理的约束，使得我们不得不放弃传统的强一致性，而转而追求最终一致性，这个对开发人员来说是一个挑战。</p>
<p>微服务架构对测试也带来了很大的挑战。传统的单体WEB应用只需测试单一的REST API即可，而对微服务进行测试，需要启动它依赖的所有其他服务。这种复杂性不可低估。</p>
<p>微服务的另一大挑战是跨多个服务的更改。比如在传统单体应用中，若有A、B、C三个服务需要更改，A依赖B，B依赖C。我们只需更改相应的模块，然后一次性部署即可。但是在微服务架构中，我们需要仔细规划和协调每个服务的变更部署。我们需要先更新C，然后更新B，最后更新A。</p>
<p>部署基于微服务的应用也要复杂得多。单体应用可以简单的部署在一组相同的服务器上，然后前端使用负载均衡即可。每个应用都有相同的基础服务地址，例如数据库和消息队列。而微服务由不同的大量服务构成。每种服务可能拥有自己的配置、应用实例数量以及基础服务地址。这里就需要不同的配置、部署、扩展和监控组件。此外，我们还需要服务发现机制，以便服务可以发现与其通信的其他服务的地址。因此，成功部署微服务应用需要开发人员有更好地部署策略和高度自动化的水平。</p>
<p><img alt data-src="https://cdn.nlark.com/yuque/0/2019/png/351829/1564062904031-626d2a48-0efd-4fb1-a2c1-f8079a26696e.png#align=left&display=inline&height=616&originHeight=616&originWidth=1038&size=0&status=done&width=1038" class="lazyload"></p>
<p><a href="http://microservices.io/patterns/microservices.html" target="_blank" rel="noopener">这里</a>有一个图非常好的总结微服务架构需要考虑的问题，包括:</p>
<ul>
<li>API Gateway</li>
<li>服务间调用</li>
<li>服务发现</li>
<li>服务容错</li>
<li>服务部署</li>
<li>数据调用</li>
</ul>
<p><img alt data-src="https://cdn.nlark.com/yuque/0/2019/png/351829/1564062902478-7f871518-68c5-4d30-bfeb-634a6ff445d3.png#align=left&display=inline&height=719&originHeight=719&originWidth=839&size=0&status=done&width=839" class="lazyload"></p>
<p><a name="25f9c7fa"></a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>对于大的互联网公司，微服务架构是血液，是习惯，每家公司都有自己的套路和架构，细节有不同，但是核心理念是通的。</li>
<li>对于一般的公司而言，实践微服务有非常大的技术挑战，于是乎才有了这么多IT供应商考虑这里的商机。微服务比较适合未来有一定的扩展复杂度，且有 很大用户增量预期的应用，说人话就是新兴的互联网公司。创业初期，不可能买大量的机器或者很贵的机器，但是又必须考虑应对成功后的巨量的用户，微服务架构 成了最好的选择。</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">Fulin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/07/25/%E4%B8%80%E8%B5%B7%E6%9D%A5%E5%AD%A6SpringColud%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%9D%E5%A7%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1/">http://yoursite.com/2019/07/25/%E4%B8%80%E8%B5%B7%E6%9D%A5%E5%AD%A6SpringColud%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%9D%E5%A7%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">FuLinLin</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringCloud/">SpringCloud    </a></div><div class="post_share"><div class="social-share" data-image="/img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechatpay.png"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.png"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/07/25/SpringBoot%20%E5%B8%B8%E7%94%A8%E7%9A%84%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F/"><img class="prev_cover lazyload" data-src="/img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>SpringBoot 常用的部署方式</span></div></a></div><div class="next-post pull_right"><a href="/2019/07/25/Centos7%20%E5%AE%89%E8%A3%85gitlab/"><img class="next_cover lazyload" data-src="/img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Centos7 安装gitlab</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'yl2NuJhAyU0CzXocbwW4prT6-gzGzoHsz',
  appKey:'4vND96RyDvYOEkTfzhHjhX9j',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></div><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 By Fulin</div><div class="framework-info"><span>Powered by </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"><span>京ICP备19023481号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="/js/search/local-search.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>